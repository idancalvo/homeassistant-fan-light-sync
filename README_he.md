# Home Assistant – סנכרון בין מאוורר, מתג ותאורה

## הקדמה

פרויקט זה מאפשר סנכרון בין מאווררי תקרה, מתגי קיר חכמים ונורות, באמצעות מערכת Home Assistant.  
המערכת מבוססת על אוטומציות שמבצעות את הסנכרון בצורה חכמה ויציבה.

---

## רכיבים במערכת

המדריך והקבצים מותאמים לעבודה עם מספר מאווררים ומתגים, אך בדוגמה כאן מוצג רק **מאוורר אחד ומתְג אחד**, כדי לשמור על פשטות.  
ניתן להרחיב את ההגדרות בצורה פשוטה – מוסבר בהמשך.

### 1. מאוורר תקרה עם רכיב SONOFF iFan04 (צרוב עם Tasmota)

- מאוורר תקרה שמחובר לבקר SONOFF iFan04.
- הבקר צרוב עם קושחה מסוג **Tasmota**.
- מאפשר שליטה מלאה על המאוורר + תאורה דרך Home Assistant.
- 🔗 מדריך לצריבת Tasmota:  
  [Tasmota iFan04 Flash Guide](https://tasmota.github.io/docs/devices/sonoff_ifan04/)

### 2. מתג קיר חכם SONOFF ZBM5 120 (זיגבי)

- מתג כפול מדגם SONOFF ZBM5 120.
- פועל בפרוטוקול Zigbee – דורש רכזת Zigbee.
- משמש לשליטה על המאוורר והתאורה, ללא ניתוק חשמל בפועל.

---

## שמות הישויות (Entities)

| סוג רכיב        | שם ישות לדוגמה                     |
|------------------|-------------------------------------|
| מאוורר           | `fan.bedroom_fan`                   |
| מתג שליטה על מאוורר | `switch.bedroom_switch_fan`         |
| מתג שליטה על תאורה  | `switch.bedroom_switch_light`       |
| תאורה           | `light.bedroom_light`               |

\* ניתן להוסיף מאווררים ומתגים נוספים על ידי הרחבת מיפוי הישויות בתוך קובצי האוטומציה (הסבר בהמשך).

---

## מיקום הקבצים והפעלת האוטומציות

### 1. שמירת הקבצים

יש לשמור את קובצי האוטומציה בתיקייה:
```
/config/automations/
```

קבצים לדוגמה:
- `sync_fan_to_switch.yaml`
- `sync_light_to_switch.yaml`
- `sync_switch_to_fan.yaml`
- `sync_switch_to_light.yaml`


### 2. טעינת האוטומציות

#### אפשרות 1 – הוספה לקובץ הראשי `automations.yaml`

אם אתה משתמש בקובץ אחד מרכזי לאוטומציות, ניתן פשוט להעתיק את התוכן של כל אחד מהקבצים לקובץ הזה.

#### אפשרות 2 – שימוש ב־!include_dir_merge_list

מומלץ לעבוד עם קבצים נפרדים ולשלב אותם בעזרת:

```yaml
automation: !include_dir_merge_list automations/
```

יש להוסיף זאת לקובץ `configuration.yaml`.

### 3. הפעלת האוטומציות

לאחר שמירת הקבצים, יש לבצע ריענון לאוטומציות:

> הגדרות → אוטומציות וסצנות → תפריט ⋮ → טעינה מחדש של אוטומציות  
או פשוט להפעיל מחדש את Home Assistant.

---

## הוספת עוד מאווררים ומתגים

כל קובץ YAML כולל משתנה מיפוי `map` שמגדיר את הקשר בין מתג למאוורר (או לאור).  
להוספת עוד רכיבים – יש להוסיף שורות נוספות.

לדוגמה:

```yaml
variables:
  switch_map:
    fan.bedroom_fan: switch.bedroom_switch_fan
    # fan.kidsroom_fan: switch.kidsroom_switch_fan
    # fan.playroom_fan: switch.playroom_switch_fan
```

שורות עם `#` הן שורות הערה. ניתן להסיר את הסולמית כדי להפעיל אותן או להוסיף ישויות משלך.

---

## הסבר חשמלי – איך זה עובד

- **המאוורר מחובר ישירות לחשמל** – כך שהוא נשאר מחובר לרשת כל הזמן.
- **המתג גם מחובר ישירות לחשמל** – הוא רק שולח פקודות, ולא מנתק חשמל בפועל.
- הכיבוי וההדלקה מתבצעים **ברמת הרכיב**, ולא על ידי ניתוק מתח.

---

## ⚠️ אזהרת בטיחות

> המחבר אינו לוקח אחריות על תקלות ובעיות – הן בחומרה והן בתוכנה.  
> כל הנעשה באחריות המשתמש בלבד!  
> יש לבצע עבודות חשמל **על ידי חשמלאי מוסמך בלבד**.  
> יש לבצע **גיבוי מלא למערכת Home Assistant** לפני שמבצעים שינויים.

---

## סיכום

- הפרויקט מאפשר סנכרון בין מתגים, מאווררי תקרה ונורות.
- מתאים למערכת מבוזרת עם כמה חדרים/מתגים.
- האוטומציות גמישות ומודולריות.

💬 **אשמח לקבל תגובות והצעות שיפור**  
למדריך או לקוד – ניתן לפתוח issue או לשלוח pull request דרך GitHub.

---
